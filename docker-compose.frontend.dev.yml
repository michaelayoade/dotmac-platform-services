# Frontend Development with Bind Mounts
# Usage: docker compose -f docker-compose.frontend.dev.yml up --build

services:
  platform-frontend-dev:
    build:
      context: .
      dockerfile: frontend/Dockerfile.dev
    container_name: dotmac-frontend-dev
    restart: unless-stopped

    # Bind mounts for hot reloading
    volumes:
      # Source code directories - live editing
      - ./frontend/app:/app/frontend/app
      - ./frontend/components:/app/frontend/components
      - ./frontend/lib:/app/frontend/lib
      - ./frontend/providers:/app/frontend/providers
      - ./frontend/types:/app/frontend/types
      - ./frontend/public:/app/frontend/public

      # Config files (read-only to prevent container writes)
      - ./frontend/next.config.mjs:/app/frontend/next.config.mjs:ro
      - ./frontend/tailwind.config.ts:/app/frontend/tailwind.config.ts:ro
      - ./frontend/tsconfig.json:/app/frontend/tsconfig.json:ro
      - ./frontend/postcss.config.js:/app/frontend/postcss.config.js:ro
      - ./frontend/.env.local:/app/frontend/.env.local:ro

      # Preserve node_modules from container (don't overwrite with host)
      - frontend_node_modules:/app/frontend/node_modules
      - root_node_modules:/app/node_modules

    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_URL: http://localhost:8000
      NEXT_PUBLIC_API_BASE_URL: http://localhost:8000
      API_URL: http://dotmac-backend:8000
      NEXT_PUBLIC_WS_URL: ws://localhost:8000
      NEXTAUTH_SECRET: dev-nextauth-secret-change-me-min-32-chars
      NEXTAUTH_URL: http://localhost:3000
      # Enable hot reload
      WATCHPACK_POLLING: "true"
      CHOKIDAR_USEPOLLING: "true"

    ports:
      - "3000:3000"

    networks:
      - dotmac-network

    # Health check
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  frontend_node_modules:
  root_node_modules:

networks:
  dotmac-network:
    external: true
