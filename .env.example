# =============================================================================
# ISP OPERATIONS PLATFORM - Environment Configuration
# Copy this file to .env and update with your actual values
# DO NOT commit .env to version control
# =============================================================================

# =============================================================================
# PLATFORM CONFIGURATION
# =============================================================================
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO
PLATFORM_NAME=DotMac ISP Platform
PLATFORM_DOMAIN=localhost
PLATFORM_URL=http://localhost:8000
SECRET_KEY=dev_local_platform_secret_key_please_override

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# PostgreSQL - Main Database
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=dotmac
POSTGRES_USER=dotmac_user
POSTGRES_PASSWORD=dev_local_pg_password_123
POSTGRES_MAX_CONNECTIONS=100
DATABASE_URL=postgresql://${POSTGRES_USER}:${POSTGRES_PASSWORD}@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}
DATABASE_POOL_SIZE=5
DATABASE_MAX_OVERFLOW=10

# Database Development Options
# Set to 'true' to skip database initialization if schema already exists (suppresses index warnings)
SKIP_DB_INIT_IF_EXISTS=false

# Database Migration Options
# AUTO_MIGRATE: Controls whether Alembic migrations run automatically on container startup
# - true (default): Migrations run automatically when API container starts
#   Good for: Development, single-instance deployments
# - false: Migrations must be run manually via `docker exec <container> migrate` or a dedicated init job
#   Good for: Production with multiple replicas (prevents migration race conditions)
#   Recommended: Use a Kubernetes init container or separate migration job in production
AUTO_MIGRATE=true

# TimescaleDB - Time-Series Metrics
TIMESCALE_HOST=timescaledb
TIMESCALE_PORT=5432
TIMESCALE_DB=metrics
TIMESCALE_USER=timescale_user
TIMESCALE_PASSWORD=dev_local_timescale_password

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=dev_local_redis_password_123
REDIS_DB=0
REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/${REDIS_DB}

# =============================================================================
# AUTHENTICATION & AUTHORIZATION (Phase 1 - Centralized)
# =============================================================================
# CRITICAL: JWT Secret Key (load from Vault in production!)
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
JWT_SECRET_KEY=dev_local_jwt_secret_key_min_32_chars
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=7

# Session Management (uses separate Redis DB for isolation)
SESSION_REDIS_URL=redis://:${REDIS_PASSWORD}@${REDIS_HOST}:${REDIS_PORT}/1

# User Defaults
DEFAULT_USER_ROLE=user

# SECURITY: Self-Registration Control
# Controls whether users can register accounts via POST /api/v1/auth/register
# PRODUCTION: Set to 'false' to disable public self-registration
# DEVELOPMENT: Set to 'true' only for initial setup/testing
# When disabled, administrators must create users via POST /api/v1/users
ALLOW_SELF_REGISTRATION=false

# Upload Limits
MAX_AVATAR_SIZE_MB=5

# Legacy JWT Settings (backwards compatibility - will be deprecated)
JWT_SECRET=dev_local_legacy_jwt_secret
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# =============================================================================
# EXTERNAL SERVICES (Phase 2 - Centralized)
# =============================================================================
# OSS/BSS Service URLs - Centralized endpoint configuration for external systems

# GenieACS (TR-069 ACS for CPE management)
GENIEACS_URL=http://genieacs:7557
GENIEACS_USERNAME=
GENIEACS_PASSWORD=

# NetBox (IPAM/DCIM for network inventory)
NETBOX_URL=http://netbox:8080
NETBOX_API_TOKEN=

# VOLTHA (OLT management for PON networks)
VOLTHA_URL=http://voltha:8881
VOLTHA_USERNAME=
VOLTHA_PASSWORD=
VOLTHA_TOKEN=

# Ansible AWX (Network automation)
AWX_URL=http://awx:80
AWX_USERNAME=admin
AWX_PASSWORD=password
AWX_TOKEN=

# Search Services
MEILISEARCH_URL=http://meilisearch:7700
MEILISEARCH_API_KEY=
ELASTICSEARCH_URL=http://elasticsearch:9200

# Frontend Application URLs
FRONTEND_URL=http://localhost:3000
FRONTEND_ADMIN_URL=http://localhost:3001

# RADIUS CoA API (if using HTTP API instead of UDP)
RADIUS_COA_API_URL=http://radius:8080/coa

# =============================================================================
# SECURITY & AUTHENTICATION
# =============================================================================
# Account Lockout
SECURITY__MAX_FAILED_LOGIN_ATTEMPTS=5
SECURITY__ACCOUNT_LOCKOUT_DURATION_HOURS=1
SECURITY__FAILED_LOGIN_RESET_MINUTES=30

# Password Policy
SECURITY__PASSWORD_MIN_LENGTH=8
SECURITY__PASSWORD_REQUIRE_UPPERCASE=true
SECURITY__PASSWORD_REQUIRE_LOWERCASE=true
SECURITY__PASSWORD_REQUIRE_DIGITS=true
SECURITY__PASSWORD_REQUIRE_SPECIAL=false

# Session Security
SECURITY__SESSION_TIMEOUT_MINUTES=60
SECURITY__SESSION_ABSOLUTE_TIMEOUT_HOURS=24
SECURITY__CONCURRENT_SESSIONS_ALLOWED=true
SECURITY__MAX_CONCURRENT_SESSIONS=5

# Security Headers
SECURITY__ENABLE_HSTS=false
SECURITY__HSTS_MAX_AGE_SECONDS=31536000
SECURITY__ENABLE_CSP=false
SECURITY__ENABLE_XSS_PROTECTION=true

# =============================================================================
# TENANT CONFIGURATION
# =============================================================================
# Options: "single" or "multi"
TENANT_MODE=multi

# Default tenant ID (used in single-tenant mode, or as fallback in multi-tenant)
DEFAULT_TENANT_ID=default

# Whether to require tenant identification in multi-tenant mode
REQUIRE_TENANT_HEADER=true

# Header name for tenant ID (defaults to X-Tenant-ID)
TENANT_HEADER_NAME=X-Tenant-ID

# Query parameter for tenant ID (defaults to tenant_id)
TENANT_QUERY_PARAM=tenant_id

# Advanced tenant features (usually false for security)
ENABLE_TENANT_SWITCHING=false
ENABLE_CROSS_TENANT_QUERIES=false

# Multi-Tenant Limits
DEFAULT_TENANT_PLAN=basic
MAX_SUBSCRIBERS_PER_TENANT=1000
TENANT_ISOLATION_MODE=strict

# =============================================================================
# API CONFIGURATION
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
API_VERSION=v1
API_PREFIX=/api/v1
API_TITLE=ISP Operations Platform API
MAX_UPLOAD_SIZE_MB=100

# CORS
CORS_ORIGINS=["http://localhost:3000", "http://localhost:3001"]

# Rate Limiting
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000

# =============================================================================
# VAULT/SECRETS MANAGEMENT
# =============================================================================
# Vault is OPTIONAL in development. If not configured, system uses .env values
# To enable Vault: 1) Start vault container, 2) Set VAULT__ENABLED=true
VAULT__ENABLED=false
VAULT_URL=http://openbao:8200
VAULT_TOKEN=root
VAULT_MOUNT_POINT=secret
VAULT_NAMESPACE=dotmac

# =============================================================================
# OBJECT STORAGE (MinIO)
# =============================================================================
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=dev_local_minio_root_pw
MINIO_ENDPOINT=minio:9000
MINIO_BUCKET_NAME=isp-platform
MINIO_USE_SSL=false

# Match application storage settings when running outside docker-compose
STORAGE__ENDPOINT=localhost:9000
STORAGE__ACCESS_KEY=minioadmin
STORAGE__SECRET_KEY=dev_local_minio_storage_secret
STORAGE__BUCKET=isp-platform
STORAGE__USE_SSL=false
STORAGE__LOCAL_PATH=/var/lib/dotmac/storage

# =============================================================================
# RADIUS CONFIGURATION
# =============================================================================
# FreeRADIUS Database Connection
RADIUS_DB_TYPE=postgresql
RADIUS_DB_HOST=${POSTGRES_HOST}
RADIUS_DB_PORT=${POSTGRES_PORT}
RADIUS_DB_NAME=${POSTGRES_DB}
RADIUS_DB_USER=${POSTGRES_USER}
RADIUS_DB_PASSWORD=${POSTGRES_PASSWORD}

# RADIUS Server Settings
RADIUS_AUTH_PORT=1812
RADIUS_ACCT_PORT=1813
RADIUS_STATUS_PORT=18120

# RADIUS CoA (Change of Authorization) Configuration
# Server connection
RADIUS_SERVER_HOST=localhost
RADIUS_COA_PORT=3799

# Shared secret for RADIUS authentication
# SECURITY: In production, store this in HashiCorp Vault
# For production, leave empty and configure Vault path: radius/shared-secret
RADIUS_SECRET=dev_local_radius_shared_secret

# Dictionary files (attribute definitions)
# These are NOT secrets - they define RADIUS attribute schemas
# Default: Uses bundled dictionaries from config/radius/
# For production, download from FreeRADIUS: ./scripts/setup_radius_dictionaries.sh
RADIUS_DICTIONARY_PATH=./config/radius/dictionary
RADIUS_DICTIONARY_COA_PATH=./config/radius/dictionary.rfc5176

# Connection settings
RADIUS_TIMEOUT=5
RADIUS_MAX_RETRIES=2

# HTTP API fallback (optional)
# If you have a RADIUS CoA HTTP API server, you can use it instead of native RADIUS protocol
RADIUS_USE_HTTP_API=false
# RADIUS_HTTP_API_URL=http://radius-coa-api:8080/coa
# RADIUS_HTTP_API_KEY=  # Store in Vault: radius/http-api-key

# Multi-Vendor RADIUS Support (NEW)
# Enable vendor-specific attribute generation and CoA handling
RADIUS_DEFAULT_VENDOR=mikrotik
# Options: mikrotik, cisco, huawei, juniper, generic
# - mikrotik: Uses Mikrotik-Rate-Limit (default, backward compatible)
# - cisco:    Uses Cisco-AVPair for QoS policies
# - huawei:   Uses Huawei-Input/Output-Rate-Limit VSAs
# - juniper:  Uses Juniper-Rate-Limit-In/Out or ERX-Qos-Profile-Name
# - generic:  Falls back to Mikrotik behavior

RADIUS_VENDOR_AWARE=true
# Enable/disable vendor-specific handling
# If false, all operations use Mikrotik format regardless of NAS vendor
# If true, system auto-detects NAS vendor and uses appropriate attributes

# =============================================================================
# NETBOX CONFIGURATION (IPAM/DCIM)
# =============================================================================
NETBOX_DB_NAME=netbox
NETBOX_SECRET_KEY=dev_local_netbox_secret_key_that_is_longer_than_50_chars!!
NETBOX_ADMIN_USER=admin
NETBOX_ADMIN_EMAIL=admin@example.com
NETBOX_ADMIN_PASSWORD=admin
NETBOX_SKIP_SUPERUSER=false
NETBOX_ALLOWED_HOSTS=*

# =============================================================================
# MONGODB CONFIGURATION (for GenieACS)
# =============================================================================
MONGO_HOST=mongodb
MONGO_PORT=27017
MONGO_USER=admin
MONGO_PASSWORD=dev_local_mongo_password
MONGO_DATABASE=genieacs
MONGO_AUTH_SOURCE=admin

# =============================================================================
# GENIEACS CONFIGURATION (TR-069 ACS)
# =============================================================================
GENIEACS_CWMP_PORT=7547
GENIEACS_NBI_PORT=7557
GENIEACS_UI_PORT=7567
GENIEACS_FS_PORT=7577
GENIEACS_MONGODB_CONNECTION_URL=mongodb://${MONGO_USER}:${MONGO_PASSWORD}@${MONGO_HOST}:${MONGO_PORT}/${MONGO_DATABASE}?authSource=${MONGO_AUTH_SOURCE}

# =============================================================================
# WIREGUARD VPN CONFIGURATION
# =============================================================================
WG_SERVER_URL=auto
WG_SERVER_PORT=51820
WG_PEERS=10
WG_INTERNAL_SUBNET=10.200.0.0/16
WG_ALLOWED_IPS=0.0.0.0/0

# =============================================================================
# LIBRENMS CONFIGURATION
# =============================================================================
LIBRENMS_DB_NAME=librenms
LIBRENMS_SNMP_COMMUNITY=public
LIBRENMS_ADMIN_USER=admin
LIBRENMS_ADMIN_PASSWORD=admin

# =============================================================================
# ANSIBLE AWX CONFIGURATION
# =============================================================================
AWX_DB_NAME=awx
AWX_ADMIN_USER=admin
AWX_ADMIN_PASSWORD=dev_local_awx_admin_pass
AWX_SECRET_KEY=dev_local_awx_secret_key_here

# =============================================================================
# MONITORING & OBSERVABILITY
# =============================================================================
# Grafana
GRAFANA_ADMIN_USER=admin
GRAFANA_PASSWORD=admin
GRAFANA_PORT=3000

# Prometheus
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_TIME=30d

# Alertmanager
ALERTMANAGER_PORT=9093
ALERTMANAGER_WEBHOOK_SECRET=dev_local_alertmanager_secret
ALERTMANAGER_WEBHOOK_URL=http://host.docker.internal:8000/api/v1/monitoring/alerts/webhook

# SMTP for Alerts
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-specific-password
SMTP_FROM=alerts@isp-platform.com

# Jaeger (Distributed Tracing)
JAEGER_UI_PORT=16686
JAEGER_COLLECTOR_PORT=14268
JAEGER_OTLP_GRPC_PORT=4317
JAEGER_OTLP_HTTP_PORT=4318

# Loki (Log Aggregation)
LOKI_PORT=3100

# OpenTelemetry Configuration
OTEL_ENABLED=false
OTEL_ENDPOINT=http://jaeger:4318
OTEL_SERVICE_NAME=dotmac-platform

# =============================================================================
# CELERY CONFIGURATION
# =============================================================================
CELERY_BROKER_URL=${REDIS_URL}
CELERY_RESULT_BACKEND=${REDIS_URL}
CELERY_TASK_ALWAYS_EAGER=false
CELERY_WORKER_CONCURRENCY=4
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================
# Docker Network
DOCKER_NETWORK_NAME=dotmac-network
DOCKER_NETWORK_SUBNET=172.20.0.0/16

# IP Pool Configuration
DEFAULT_IP_POOL_START=10.100.0.1
DEFAULT_IP_POOL_END=10.100.255.254
DEFAULT_IP_POOL_SUBNET=10.100.0.0/16

# =============================================================================
# FTTH CONFIGURATION
# =============================================================================
# OLT Default Settings
DEFAULT_OLT_VENDOR=huawei
DEFAULT_OLT_SNMP_VERSION=v2c
DEFAULT_OLT_SNMP_COMMUNITY=public

# ONU Provisioning
ONU_AUTO_DISCOVERY=true
ONU_AUTO_PROVISION=false

# =============================================================================
# WIRELESS CONFIGURATION
# =============================================================================
DEFAULT_WIRELESS_FREQUENCY=5GHz
DEFAULT_WIRELESS_CHANNEL_WIDTH=40

# =============================================================================
# FEATURE FLAGS
# =============================================================================
FEATURE_FTTH_ENABLED=true
FEATURE_WIRELESS_ENABLED=true
FEATURE_ROUTER_MANAGEMENT_ENABLED=true
FEATURE_VPN_MANAGEMENT_ENABLED=true
FEATURE_MAPS_ENABLED=true
FEATURE_MOBILE_APP_ENABLED=false

# =============================================================================
# NOTIFICATION CONFIGURATION
# =============================================================================
# Email
EMAIL_ENABLED=true
EMAIL_HOST=${SMTP_HOST}
EMAIL_PORT=${SMTP_PORT}
EMAIL_USERNAME=${SMTP_USERNAME}
EMAIL_PASSWORD=${SMTP_PASSWORD}
EMAIL_FROM=${SMTP_FROM}
EMAIL_USE_TLS=true

# SMS (Twilio)
SMS_ENABLED=false
TWILIO_ACCOUNT_SID=your_twilio_account_sid
TWILIO_AUTH_TOKEN=your_twilio_auth_token
TWILIO_FROM_NUMBER=+1234567890

# =============================================================================
# BILLING CONFIGURATION
# =============================================================================
# Subscription & Trial Settings
BILLING__DEFAULT_TRIAL_DAYS=14
BILLING__DEFAULT_CURRENCY=USD

# Payment Retry Settings
BILLING__PAYMENT_RETRY_ATTEMPTS=3
BILLING__PAYMENT_RETRY_INTERVAL_HOURS=24
BILLING__PAYMENT_RETRY_EXPONENTIAL_BASE_HOURS=2

# Invoice Settings
BILLING__INVOICE_DUE_DAYS=30
BILLING__GRACE_PERIOD_DAYS=3

# =============================================================================
# BACKUP CONFIGURATION
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=isp-platform-backups

# =============================================================================
# COMPLIANCE & SECURITY
# =============================================================================
# Audit Logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_YEARS=7

# GDPR
GDPR_ENABLED=true
DATA_RETENTION_DAYS=2555

# Security
FORCE_HTTPS=false
SECURE_COOKIES=false
HSTS_ENABLED=false

# =============================================================================
# NOTES
# =============================================================================
# 1. Change ALL default passwords before production deployment
# 2. Generate secure secrets using: openssl rand -hex 32
# 3. Store sensitive credentials in HashiCorp Vault in production
# 4. Enable HTTPS and secure cookies in production
# 5. Configure proper SMTP/email settings for alerts
# 6. Review and adjust rate limits based on your needs
# 7. Configure CORS origins for your frontend domains
# 8. Set TENANT_MODE=multi for ISP multi-tenant operations
# =============================================================================
# FAULT MANAGEMENT & ARCHIVAL
# =============================================================================
# Alarm Archival
FAULT_MANAGEMENT__ALARM_RETENTION_DAYS=90
FAULT_MANAGEMENT__ARCHIVE_TIME_HOUR=2
FAULT_MANAGEMENT__ARCHIVE_TIME_MINUTE=0
FAULT_MANAGEMENT__ARCHIVE_BATCH_SIZE=1000
FAULT_MANAGEMENT__ARCHIVE_COMPRESSION_LEVEL=9

# Alarm Correlation
FAULT_MANAGEMENT__CORRELATION_WINDOW_SECONDS=300
FAULT_MANAGEMENT__MAX_OCCURRENCE_COUNT=100

# SLA Tracking
FAULT_MANAGEMENT__SLA_CHECK_INTERVAL_SECONDS=60

# Notifications
FAULT_MANAGEMENT__CRITICAL_ALARM_AUTO_NOTIFY=true
FAULT_MANAGEMENT__ESCALATION_TIMEOUT_MINUTES=30

# =============================================================================
# NOTIFICATION CHANNELS
# =============================================================================
# Email Channel (uses SMTP settings from MONITORING section)
NOTIFICATIONS__EMAIL_ENABLED=true

# SMS Channel (Twilio, AWS SNS, or HTTP API)
NOTIFICATIONS__SMS_ENABLED=false
NOTIFICATIONS__SMS_PROVIDER=twilio
# Twilio Configuration
NOTIFICATIONS__TWILIO_ACCOUNT_SID=
NOTIFICATIONS__TWILIO_AUTH_TOKEN=
NOTIFICATIONS__TWILIO_FROM_NUMBER=
# Custom SMS API (if using http provider)
NOTIFICATIONS__SMS_HTTP_API_URL=
NOTIFICATIONS__SMS_HTTP_API_KEY=
# SMS Settings
NOTIFICATIONS__SMS_MAX_LENGTH=160
NOTIFICATIONS__SMS_MIN_PRIORITY=HIGH
NOTIFICATIONS__SMS_MAX_RETRIES=2

# Push Notifications (Firebase, OneSignal, AWS SNS, or HTTP API)
NOTIFICATIONS__PUSH_ENABLED=false
NOTIFICATIONS__PUSH_PROVIDER=fcm
# Firebase Cloud Messaging
NOTIFICATIONS__FCM_CREDENTIALS_PATH=
# OneSignal
NOTIFICATIONS__ONESIGNAL_APP_ID=
NOTIFICATIONS__ONESIGNAL_API_KEY=
# Custom Push API (if using http provider)
NOTIFICATIONS__PUSH_HTTP_API_URL=
NOTIFICATIONS__PUSH_HTTP_API_KEY=
# Push Settings
NOTIFICATIONS__PUSH_MIN_PRIORITY=MEDIUM
NOTIFICATIONS__PUSH_MAX_RETRIES=3

# Webhook Notifications (Slack, Teams, Discord, Custom)
NOTIFICATIONS__WEBHOOK_ENABLED=false
NOTIFICATIONS__WEBHOOK_URLS=[]
NOTIFICATIONS__WEBHOOK_FORMAT=standard
NOTIFICATIONS__WEBHOOK_SECRET=
NOTIFICATIONS__WEBHOOK_TIMEOUT=10.0
NOTIFICATIONS__WEBHOOK_MAX_RETRIES=3

# AWS Configuration (shared for SNS)
NOTIFICATIONS__AWS_REGION=us-east-1
